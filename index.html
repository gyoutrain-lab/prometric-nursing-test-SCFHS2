<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CBT – Nurse Technician (SCFHS-Style Simulation)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#f4f6f8;margin:0}
header{background:#0b3c5d;color:#fff;padding:14px}
section{padding:20px}
.card{background:#fff;padding:16px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
button{padding:10px 16px;border:none;border-radius:6px;background:#0b3c5d;color:#fff}
.option{border:1px solid #ccc;border-radius:6px;padding:8px;margin:6px 0;cursor:pointer}
.option.selected{background:#d9ebff;border-color:#0056b3}
.hidden{display:none}
.badge{font-size:11px;padding:3px 6px;border-radius:4px;margin-left:6px}
.failfast{background:#f8d7da;color:#721c24}
.hardstop{background:#fff3cd;color:#856404}
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{border:1px solid #ccc;padding:6px}
th{background:#eee}
</style>
</head>

<body>
<header>
<h3>CBT – Nurse Technician (SCFHS-Style Simulation)</h3>
</header>

<section id="login">
<div class="card">
<h4>Candidate Login</h4>
<input id="name" placeholder="Full Name" style="width:100%;padding:8px">
<br><br>
<button onclick="start()">Start Exam</button>
</div>
</section>

<section id="exam" class="hidden">
<div class="card">
<div id="meta"></div>
<h4 id="question"></h4>
<div id="options"></div>
<br>
<button onclick="next()">Next</button>
</div>
</section>

<section id="result" class="hidden">
<div class="card">
<h4>Result</h4>
<div id="output"></div>
<button onclick="admin()">Admin Dashboard</button>
</div>
</section>

<section id="admin" class="hidden">
<div class="card">
<h4>Admin / Proctor</h4>
<button onclick="csv()">Export CSV</button>
<button onclick="json()">Export JSON</button>
<table id="table">
<tr><th>Name</th><th>Score</th><th>Result</th><th>Violations</th></tr>
</table>
</div>
</section>

<script>
/* ================= BLUEPRINT ================= */
const WEIGHT={
"Patient Safety":0.30,
"Clinical Judgment":0.25,
"Infection Control":0.15,
"Vitals & Monitoring":0.15,
"Ethics & Scope":0.15
};
const PASS=70;

/* ================= QUESTION BANK ================= */
const bank=[];
function add(q,o,a,d,ff,hs){bank.push({q,o,a,d,ff,hs});}

/* ====== PROPORTIONAL SCFHS-STYLE DISTRIBUTION ====== */
/* Patient Safety – 36 */
for(let i=1;i<=36;i++){
add(
`Patient Safety ${i}: A hospitalized patient shows acute deterioration. What is the MOST appropriate immediate action within your role?`,
[
"Continue routine care and observe",
"Notify the nurse immediately with objective data",
"Document the finding for later review",
"Attempt independent intervention"
],
1,"Patient Safety",true,false);
}

/* Clinical Judgment – 30 */
for(let i=1;i<=30;i++){
add(
`Clinical Judgment ${i}: You identify a change in patient condition. Which action demonstrates correct prioritization?`,
[
"Delay action until reassessment",
"Escalate promptly using clinical findings",
"Wait for physician rounds",
"Ask another technician for opinion"
],
1,"Clinical Judgment",true,false);
}

/* Infection Control – 18 */
for(let i=1;i<=18;i++){
add(
`Infection Control ${i}: During patient care, which action best prevents cross-contamination?`,
[
"Use gloves only when visibly soiled",
"Perform hand hygiene before and after contact",
"Reuse PPE if patient is stable",
"Delay hand hygiene until task completion"
],
1,"Infection Control",false,false);
}

/* Vitals & Monitoring – 18 */
for(let i=1;i<=18;i++){
add(
`Vitals ${i}: Which finding requires immediate reporting to the nurse?`,
[
"BP 120/80 mmHg",
"Respiratory rate 32/min",
"Temperature 36.7°C",
"Pulse 76 bpm"
],
1,"Vitals & Monitoring",true,false);
}

/* Ethics & Scope – 18 (Hard Stop) */
for(let i=1;i<=18;i++){
add(
`Scope ${i}: You are asked to perform a task outside your scope. What is the correct response?`,
[
"Perform the task if confident",
"Refuse and report to the nurse",
"Ask another technician to do it",
"Document and proceed"
],
1,"Ethics & Scope",false,true);
}

/* ================= ENGINE ================= */
let i=0,ans=[],log=[],users=[],u=null,viol=0;

function start(){
const n=document.getElementById("name").value.trim();
if(!n)return alert("Name required");
u={name:n,violations:[]};
login.classList.add("hidden");
exam.classList.remove("hidden");
render();
}

function render(){
const b=bank[i];
meta.innerHTML=`Q ${i+1}/${bank.length} – ${b.d}
${b.ff?'<span class="badge failfast">FAIL-FAST</span>':''}
${b.hs?'<span class="badge hardstop">HARD-STOP</span>':''}`;
question.innerText=b.q;
options.innerHTML="";
b.o.forEach((t,x)=>{
const d=document.createElement("div");
d.className="option";
d.innerText=t;
d.onclick=()=>{
document.querySelectorAll(".option").forEach(o=>o.classList.remove("selected"));
d.classList.add("selected");
ans[i]=x;
};
options.appendChild(d);
});
}

function next(){
if(ans[i]==null)return alert("Select an option");
const b=bank[i];
const correct=ans[i]===b.a;
log.push({d:b.d,c:correct});
if(!correct&&(b.ff||b.hs)){
u.violations.push(`Critical error Q${i+1}`);
finish(true);return;
}
i++;
i>=bank.length?finish(false):render();
}

function finish(force){
exam.classList.add("hidden");
result.classList.remove("hidden");
let score=0;
for(const d in WEIGHT){
const items=log.filter(x=>x.d===d);
if(items.length){
const c=items.filter(x=>x.c).length;
score+=(c/items.length)*WEIGHT[d]*100;
}}
score=Math.round(force?0:score);
u.score=score;
u.result=(score>=PASS && u.violations.length===0)?"PASS":"FAIL";
users.push(u);
output.innerHTML=`Name: ${u.name}<br>Score: <b>${score}%</b><br>
Result: <b style="color:${u.result==="PASS"?"green":"red"}">${u.result}</b><br>
Violations: ${u.violations.length}`;
}

function admin(){
result.classList.add("hidden");
adminSec.classList.remove("hidden");
users.forEach(x=>{
const r=table.insertRow();
r.insertCell().innerText=x.name;
r.insertCell().innerText=x.score+"%";
r.insertCell().innerText=x.result;
r.insertCell().innerText=x.violations.join(" | ");
});
}

function csv(){
let c="Name,Score,Result,Violations\n";
users.forEach(x=>c+=`${x.name},${x.score},${x.result},"${x.violations.join(";")}"\n`);
download(c,"report.csv");
}
function json(){download(JSON.stringify(users,null,2),"report.json");}
function download(d,n){
const a=document.createElement("a");
a.href=URL.createObjectURL(new Blob([d]));a.download=n;a.click();
}
</script>

</body>
</html>
